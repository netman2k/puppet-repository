---
#Profiles::base
profiles::base::motd: |+

  * * * * * * * * * W A R N I N G * * * * * * * * * * *
  This system is restricted to authorized users for
  authorized use only. Unauthorized access is strictly
  prohibited and may be punishable under the Computer
  Fraud and Abuse Act of 1984 or other applicable laws.
  All persons are hereby notified that the use of this
  system constitutes consent to monitoring and auditing.
  * * * * * * * * * * * * * * * * * * * * * * * * * * *

profiles::base::login_defs::options:
  ENCRYPT_METHOD: 'SHA512'
  PASS_MAX_DAYS: 730
  PASS_MIN_DAYS: 0
  PASS_MIN_LEN: 8
  PASS_WARN_AGE: 60

# Setting for /etc/securetty
profiles::base::securetty:
  - console

# Setting for /etc/pam.d
# ghoneycutt/pam has set 'pam_fprintd.so' in the default_pam_auth_lines
# but we don't need it, that's why I reassign this values as below:
pam::pam_auth_lines:
  - 'auth        required      pam_env.so'
  - 'auth        sufficient    pam_unix.so nullok try_first_pass'
  - 'auth        requisite     pam_succeed_if.so uid >= 1000 quiet_success'
  - 'auth        required      pam_deny.so'
# ghoneycutt/pam has set to be md5 password is sufficient
# but we don't want it. so I changed it with sha512.
pam::pam_password_lines:
  - 'password    requisite     pam_pwquality.so try_first_pass local_users_only retry=3 authtok_type='
  - 'password    sufficient    pam_unix.so sha512 shadow nullok try_first_pass use_authtok'
  - 'password    required      pam_deny.so'

# Setting for /etc/limit.d
# https://forge.puppet.com/ghoneycutt/pam/readme#hiera-example-for-allowed_users
pam::limits_fragments:
  nproc:
    list:
      - '* soft nproc 20000'
      - '* hard nproc 20000'
  core:
    list:
      - '* soft core unlimited'
      - '* hard core unlimited'
  nofile:
    list:
      - '* soft nofile 16000'
      - '* hard nofile 16000'
#Profiles::RSYSLOG
#profiles::rsyslog::rate_limit_interval:
profiles::rsyslog::mainmsg_queue_timeout_enqueue: 0
profiles::rsyslog::action_queue_timeout_enqueue: 0
profiles::rsyslog::log_local_config_1:
  - local6.notice  /var/log/bash
#profiles::rsyslog::log_local_config_2:
profiles::rsyslog::remote_servers:
  - host: "logm.%{::domain}"
    port: 514
    pattern: "*.*"
    protocol: "tcp"
#Profiles::NTP
profiles::ntp::servers: &id001
  - 1.pool.ntp.org
  - 2.pool.ntp.org
profiles::ntp::restrict:
  - default kod nomodify notrap nopeer noquery
  - -6 default kod nomodify notrap nopeer noquery
  - 127.0.0.1
  - -6 ::1
  - *id001
#Profiles::SNMP
#profiles::snmp::ro_community: use secure eyaml
profiles::snmp::sys_location: Unknown
profiles::snmp::sys_services: 72
profiles::snmp::sys_name: "%{::fqdn}"
#profiles::snmp::snmpv3_user: use secure.eyaml
profiles::base::aliases::aliases:
  root:
    recipient: '/dev/null'
ssh::storeconfigs_enables: false
ssh::server_options:
    Protocol: 2
    Port:
      - 22
    SyslogFacility: AUTHPRIV
    PermitRootLogin: no
    PasswordAuthentication: no
    ChallengeResponseAuthentication: no
    MaxAuthTries: 4
    UsePAM: yes
    UseDNS: no
    AllowTcpForwarding: no
    X11Forwarding: no
    PrintMotd: yes
    Subsystem: sftp /usr/lib/openssh/sftp-server
    Match User deploy:
      PasswordAuthentication: yes

Profiles::base::sysctl:
  - 'net.ipv4.tcp_timestamps':
      ensure: "present"
      value: "0"
      target: "/etc/sysctl.d/ipv4_tcp_timestamp.conf"
      apply: true
